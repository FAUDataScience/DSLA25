---
title: "12-Dplyr data"
author: "Kevin Lanning"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---
# transforming data

```{r echo=FALSE}
knitr::opts_chunk$set(message = FALSE)
```

Once you have your data, you will almost invariably need to transform it - to sort it, to select observations or variables from it, to create new variables, to partition it into groups, or to summarize it. In R, there is a general purpose tool (ok, package) that exists for this called dplyr ("d-plier").  **Play with the various dplyr functions. Experiment. You will not break the internet**

![Fig 12.1 - pliers to play with](pliers.png)

Dplyr is part of the core of the tidyverse and hence will be loaded automatically when you load the tidyverse libraries.

```{r}
library(tidyverse)
```

The versatility of dplyr is demonstrated in Chapter 5 of R4DS, which shows how to do many basic, and some not so basic, operations on your data.  Read it closely if you haven't already done so.

## from data on the web to data in R 

We've explored a simple dataset consisting of 10,000 songs (observations) and 35 measures (variables including artist). The first step here (and for your class project and the data science challenge) will be to get the data into R. How do you this?

> Method 1: Download the file to your computer as a csv file. I usually prefer this because (a) later, it will allow the code to run even if the website changes or disappears, (b) in the likely event that I will run the code several times, it is faster to get data from my own machine than from the cloud, and (c) if there are any anomalies in the data I can look at them locally (e.g., in Notepad++).
>
> Make sure that you know where your data is on your computer.  The easiest way to do this is to work with an R project. Within R studio, create a new R project (or use an existing one). Move the csv file into this directory, so that data, code, and results will all be in the same place.

> Method 2: If, for some reason, you can't load the data on to your own machine before running R, you can import the data from the cloud directly into R. You can do this either by specifying the musicURL separately (Method 2a) or call it directly within the read_csv statement. Here, too, I would encourage you to set up and work within a project.

```{r}
library(tidyverse)
### Method 1
# music1 <- read_csv("music.csv") 
### Method 2a
musicURL <- 
  "https://think.cs.vt.edu/corgis/csv/music/music.csv?forcedownload=1"
music1 <- read_csv(musicURL)
### Method 2b
# music1 <- read_csv(
#  "https://think.cs.vt.edu/corgis/csv/music/music.csv?forcedownload=1"
#  )
```

Once the data are in R, experiment with it. Here's what we did in class.

```{r}
music1 %>%
#   filter(str_detect(location, "FL")) # | 
#   str_detect (location,"Estonia")) %>% 
#   arrange(location) %>% 
    mutate(isFLA = ifelse(str_detect(location, "FL"), 1, 0)) %>% 
    mutate(FLHOT = (isFLA * artist.hotttnesss)) %>% 
    arrange(desc(FLHOT)) %>% 
    select(artist.name) %>%   # These three lines are new.
    distinct() %>%            # Why are they here?  
    head(10)                  # What do they do?
```

In class, we used str_detect (string detect) to filter (select) all of the observations which included the string "FL" somewhere in the location variable.  Then, we used two separate mutate statements to create new variables. 

In the code above, I've added three additional lines.  Do you understand each step of what we did here and why? 

Can you do something more interesting with these data?

## babynames

We also explored the babynames library in R. You'll need to install this on your computer if you haven't already done so to. Play with it, and try grouping the data in different ways. 

```{r}
# install.packages("babynames")
library(babynames)
str(babynames)
```

## exercises

1) make progress on your class project and (if applicable) your data science challenge. Be prepared to submit a brief summary of where you are when we come back from break.

2) work with the babynames data, using the tools of dplyr. What names are most androgynous (are equally popular among males and females in a given year)? Contribute to a discussion about how to do this on Slack, building on the work of your classmates.  

