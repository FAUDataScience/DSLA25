---
title: "11-tidyverse"
author: "Kevin Lanning"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

# some tidyverse tricks



"Excerpts from *Data Science in the Tidyverse*" - Sections 0 - 2
<!-- 
This file Creative Commons Attribution 4.0 International License. 
See details at https://github.com/hadley/data-science-in-tidyverse 
-->

## From sections 00 and 01:

Setup chunk will run any time any chunk is run. 

Do you get an error? Can you fix it? 

```{r setup0312} 
library(tidyverse)
library(gapminder)
```

Simple plot syntax

```{r plot}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy))
```


## From section 02 - Transform

Here's Gapminder data (summarized in the Hans Rosling video). We'll play with it a little. 


```{r gapminder}
gapminder
```


## Dplyr

### Filter

1) Use filter to show the data for United States. (Here and in the following sections, Remove the octothorpe and replace the three dots with your own code.)

```{r filterUS}
# filter(gapminder...)
```

2) Same for NZ after 2000

```{r filterNZ2000}
# filter(gapminder...)
```

## Pipe

The pipe allows us to chain multiple operations, 

## Mutate

... while mutate creates new variables.

What would you expect this to do? (There's one way to find out!)

gapminder %>% 
  mutate(size = ifelse(pop < 10e06, "small", "large"))

```{r mutateWhat}
# gapminder 

```
Now use the pipe and mutate to create a new variable of your own that describes something meaningful in the dataset.

Describe it here:

```{r myMutate}
# gapminder 

```

## Summariz(s)e

Reduces a variable to one or more values.

Use summarise() to compute the earliest (minimum) year in the dataset

```{r summarize}
# gapminder 
```

## Group by

Summarize is really useful with group by, and group by is really useful for categorical variables. 

Find the median life expectancy by continent in 2007, or another comparison between groups (such as continent or year).

```{r summarizeGroups}
# gapminder 
```

## Joins

You often need to combine different datasets.

One way is to add new rows (observations) for your current set of variables.

Another is to add new columns (measures or variables) for your current set of observations.

Consider the following...

```{r}
country_codes
```

We can combine it with the gapminder data using a version of join, for example, ...

```{r}
gapminder %>% left_join(country_codes)
```

Note that join is smart enough to match the two files on the variable they share...

Excerpts from *Data Science in the Tidyverse* - Sections 5

Note the fivethirtyeight package.  Install, open, and play with it as you would a birthday present.

```{r setup0314} 
library(tidyverse)
library(lubridate)
library(fivethirtyeight)
```

## From section 05 - Data-Types

Find and open the General Social Survey data. 

Find the average hours of tv watched (`tvhours`) for each category of marital status (`marital`).

```{r tvMarriage}
# why doesn't this work?
#div <- filter(gss_cat, marital=="Divorced")
#div
#x = div[3]
#x <- as.numeric(x[[1]])
#mean(x)
# one method
(by_marital <- group_by(gss_cat, marital))
summarise(by_marital, avetvhours = mean(tvhours, na.rm = TRUE))

# pipe method
gss_cat%>%
  group_by(marital) %>%
    summarise(means=mean(tvhours,na.rm=TRUE))
# gss_cat
# etc
```

How did you handle missing values?

